<!-- Google tag (gtag.js) -->
<script
  async
  src="https://www.googletagmanager.com/gtag/js?id=G-V18BB36XSC"
></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());

  gtag("config", "G-V18BB36XSC", { debug_mode: true });

  const sendActivated = () => {
    const button = document.querySelector(".v-btn"); // Kinda works with any vue button

    if (!button) {
      return;
    }

    const rows = button.__vue__.$store.state.app.rows;
    let activated = [];
    for (var t = [], e = 0; e < rows.length; e++) {
      for (var i = 0; i < rows[e].objects.length; i++) {
        const object = rows[e].objects[i];

        if (!object.isSelectableMultiple && object.isActive) {
          activated.push(object.id);
        }
      }
    }

    for (let i = 0; i < activated.length; i++) {
      gtag("event", "activate_before_unload", {
        target_url: "__target_url__",
        version: "__version__",
        activated_id: activated[i].id,
        activated_name: activated[i].name,
      });
    }
  };

  window.onunload = sendActivated;
  window.onclose = sendActivated;
</script>
